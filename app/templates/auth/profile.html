{% extends 'base.html' %}
{% block title %}Profile Â· NovaTalk{% endblock %}
{% block content %}
{% include 'partials/topbar.html' %}
<div class="layout-grid">
    <aside class="sidebar surface-card tablet-hidden" id="primary-navigation">
        <div class="sidebar__header">
            <div class="md-avatar" data-avatar-refresh="self" data-avatar-alt="{{ current_user.display_name }}">
                {% if current_user.avatar_url %}
                    <img src="{{ current_user.avatar_url }}" alt="{{ current_user.display_name }}">
                {% else %}
                    <span>{{ current_user.display_name[0] }}</span>
                {% endif %}
            </div>
            <div>
                <h2 class="surface-card__title">{{ current_user.display_name }}</h2>
                <p class="surface-card__subtitle">{{ '@' ~ current_user.username.lstrip('@') }}</p>
            </div>
        </div>
        <p class="muted-text">Keep your profile up to date so collaborators can find you quickly and recognise your avatar in the inbox.</p>
        <div class="fade-divider"></div>
        <div class="md-chip-set">
            <span class="md-chip"><span class="material-symbols-rounded" aria-hidden="true">verified_user</span> Secure by default</span>
            <span class="md-chip"><span class="material-symbols-rounded" aria-hidden="true">palette</span> Theme aware</span>
            <span class="md-chip"><span class="material-symbols-rounded" aria-hidden="true">photo_camera</span> Instant preview</span>
        </div>
    </aside>
    <section class="surface-card form-card transition-layer" style="grid-column: span 2;">
        <div>
            <h1 class="hero-card__title" style="text-align:left;">Profile settings</h1>
            <p class="hero-card__body" style="text-align:left;">Update how people see you across NovaTalk. Upload a square avatar, tweak the crop, and keep your contact details current.</p>
        </div>
        <form method="post" enctype="multipart/form-data" class="form-grid" novalidate>
            {{ profile_form.hidden_tag() }}
            <input type="hidden" name="avatar_offset_x" data-avatar-offset-x value="0">
            <input type="hidden" name="avatar_offset_y" data-avatar-offset-y value="0">
            <input type="hidden" name="avatar_scale" data-avatar-scale value="1">
            <div class="avatar-controls">
                <div class="avatar-controls__primary">
                    <div class="avatar-preview" data-avatar-container>
                            <img src="{{ current_user.avatar_url }}" alt="Avatar preview" class="avatar-preview__image" data-avatar-preview>
                    </div>
                    <label class="md-filled-button md-ripple" for="avatar-input">
                        <span class="material-symbols-rounded" aria-hidden="true">upload</span>
                        <span>Upload avatar</span>
                    </label>
                    <input id="avatar-input" type="file" name="avatar" accept="image/*" data-avatar-input class="hidden">
                    <div class="range-field hidden" data-avatar-zoom-container>
                        <label for="avatar-zoom">Zoom</label>
                        <input type="range" id="avatar-zoom" name="avatar_zoom" min="1" max="2.4" step="0.01" value="1" data-avatar-zoom disabled class="avatar-controls__slider">
                    </div>
                    <p class="muted-text">Drag the image to adjust the crop. Supported formats: PNG, JPG, up to {{ config['MAX_UPLOAD_MB'] }} MB.</p>
                </div>
                <div class="avatar-controls__preview">
                    <div class="avatar-live-preview" data-avatar-live-preview-container>
                            <img src="{{ current_user.avatar_url }}" alt="Avatar live preview" data-avatar-live-preview>
                    </div>
                    <p class="muted-text muted-text--small">Live preview updates as you drag.</p>
                </div>
            </div>
            <div class="form-grid">
                <div class="input-field">
                    <label for="display_name">Display name</label>
                    {{ profile_form.display_name(id='display_name', class_='input-field__control') }}
                    {% for error in profile_form.display_name.errors %}
                        <p class="badge badge--danger">{{ error }}</p>
                    {% endfor %}
                </div>
                <div class="input-field">
                    <label for="username">Username</label>
                    {{ profile_form.username(id='username', class_='input-field__control') }}
                    {% for error in profile_form.username.errors %}
                        <p class="badge badge--danger">{{ error }}</p>
                    {% endfor %}
                </div>
                <div class="input-field">
                    <label for="email">Email</label>
                    {{ profile_form.email(id='email', class_='input-field__control') }}
                    {% for error in profile_form.email.errors %}
                        <p class="badge badge--danger">{{ error }}</p>
                    {% endfor %}
                </div>
                <div class="input-field" style="grid-column: 1 / -1;">
                    <label for="bio">Bio</label>
                    {{ profile_form.bio(id='bio', class_='input-field__control', rows='4') }}
                    {% for error in profile_form.bio.errors %}
                        <p class="badge badge--danger">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
            <div style="grid-column: 1 / -1;">
                {{ profile_form.save_changes(class_='md-filled-button md-ripple button-block') }}
            </div>
        </form>
        <div class="fade-divider" role="presentation"></div>
        <div>
            <h2 class="surface-card__title" style="text-align:left;">Change password</h2>
            <p class="hero-card__body" style="text-align:left;">Update your password to keep your account secure. Enter your current password and confirm the new password twice.</p>
        </div>
        <form method="post" class="form-grid" novalidate>
            {{ password_form.hidden_tag() }}
            <div class="form-grid">
                <div class="input-field">
                    <label for="current_password">Current password</label>
                    {{ password_form.current_password(id='current_password', class_='input-field__control', autocomplete='current-password') }}
                    {% for error in password_form.current_password.errors %}
                        <p class="badge badge--danger">{{ error }}</p>
                    {% endfor %}
                </div>
                <div class="input-field">
                    <label for="new_password">New password</label>
                    {{ password_form.new_password(id='new_password', class_='input-field__control', autocomplete='new-password') }}
                    {% for error in password_form.new_password.errors %}
                        <p class="badge badge--danger">{{ error }}</p>
                    {% endfor %}
                </div>
                <div class="input-field">
                    <label for="confirm_new_password">Confirm new password</label>
                    {{ password_form.confirm_new_password(id='confirm_new_password', class_='input-field__control', autocomplete='new-password') }}
                    {% for error in password_form.confirm_new_password.errors %}
                        <p class="badge badge--danger">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
            <div style="grid-column: 1 / -1;">
                {{ password_form.update_password(class_='md-filled-button md-ripple button-block') }}
            </div>
        </form>
    </section>
</div>
{% endblock %}